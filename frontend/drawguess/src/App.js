import { ReactSketchCanvas } from "react-sketch-canvas";
import CanvasDraw from "react-canvas-draw";
import "./App.css";
import { useEffect, useRef, useState } from "react";

function App() {
  const [size, setSize] = useState(400);
  // const [data, setData] = useState("");
  const canvasRef = useRef(null);
  const drawingRef = useRef(null);
  const [drawing, setDrawing] = useState(null);

  let resizeWindow = () => {
    const canvas = canvasRef.current;
    if (canvas) {
      const size = canvas.offsetHeight < canvas.offsetWidth ? canvas.offsetHeight : canvas.offsetWidth;
      setSize(size);

      // setData(drawingRef.current.getSaveData());
      // console.log("redrawing canvas");
      
      if(drawing) {
        drawingRef.current.loadSaveData(JSON.stringify(drawing), true);
      }
      
      // const drawing = {"lines":[{"points":[{"x":125,"y":181.921875},{"x":125,"y":181.921875},{"x":125,"y":181.921875},{"x":117,"y":181.921875},{"x":106,"y":180.921875},{"x":97,"y":177.921875},{"x":84,"y":170.921875},{"x":75,"y":164.921875},{"x":67,"y":158.921875},{"x":61,"y":152.921875},{"x":58,"y":147.921875},{"x":55,"y":139.921875},{"x":52,"y":123.921875},{"x":52,"y":116.921875},{"x":52,"y":109.921875},{"x":54,"y":102.921875},{"x":56,"y":98.921875},{"x":62,"y":94.921875},{"x":71,"y":91.921875},{"x":85,"y":89.921875},{"x":97,"y":89.921875},{"x":111,"y":92.921875},{"x":128,"y":101.921875},{"x":143,"y":109.921875},{"x":159,"y":116.921875},{"x":178,"y":128.921875},{"x":194,"y":140.921875},{"x":206,"y":149.921875},{"x":224,"y":160.921875},{"x":240,"y":167.921875},{"x":249,"y":171.921875},{"x":265,"y":176.921875},{"x":275,"y":178.921875},{"x":281,"y":178.921875},{"x":291,"y":175.921875},{"x":298,"y":170.921875},{"x":306,"y":165.921875},{"x":313,"y":154.921875},{"x":316,"y":142.921875},{"x":317,"y":131.921875},{"x":310,"y":111.921875},{"x":301,"y":96.921875},{"x":291,"y":84.921875},{"x":275,"y":70.921875},{"x":264,"y":63.921875},{"x":256,"y":59.921875},{"x":251,"y":58.921875},{"x":241,"y":57.921875},{"x":234,"y":57.921875},{"x":227,"y":59.921875},{"x":222,"y":63.921875},{"x":216,"y":74.921875},{"x":206,"y":98.921875},{"x":192,"y":131.921875},{"x":181,"y":165.921875},{"x":174,"y":186.921875},{"x":165,"y":220.921875},{"x":161,"y":233.921875},{"x":155,"y":249.921875},{"x":144,"y":266.921875},{"x":137,"y":276.921875},{"x":131,"y":284.921875},{"x":123,"y":292.921875},{"x":113,"y":297.921875},{"x":103,"y":299.921875},{"x":95,"y":301.921875},{"x":84,"y":301.921875},{"x":76,"y":297.921875},{"x":58,"y":274.921875},{"x":48,"y":247.921875},{"x":42,"y":223.921875},{"x":39.99999999999999,"y":201.921875},{"x":41,"y":191.921875},{"x":45,"y":185.921875},{"x":56,"y":177.921875},{"x":81,"y":169.921875},{"x":100,"y":165.921875},{"x":120,"y":165.921875},{"x":152,"y":172.921875},{"x":170,"y":178.921875},{"x":186,"y":188.921875},{"x":206,"y":204.921875},{"x":215,"y":212.921875},{"x":225,"y":219.921875},{"x":242,"y":231.921875},{"x":250,"y":235.921875},{"x":256,"y":239.921875},{"x":270,"y":244.921875},{"x":279,"y":245.921875},{"x":285,"y":246.921875},{"x":292,"y":246.921875},{"x":300,"y":244.921875},{"x":312,"y":241.921875},{"x":327,"y":233.921875},{"x":336,"y":227.921875},{"x":345,"y":221.921875},{"x":352,"y":213.921875},{"x":355,"y":201.921875},{"x":354,"y":185.921875},{"x":341,"y":159.921875},{"x":331,"y":148.921875},{"x":322,"y":140.921875},{"x":303,"y":132.921875},{"x":297,"y":130.921875},{"x":294,"y":130.921875},{"x":291,"y":131.921875},{"x":280,"y":138.921875},{"x":269,"y":151.921875},{"x":256,"y":171.921875},{"x":243,"y":209.921875},{"x":238,"y":226.921875},{"x":231,"y":251.921875},{"x":225,"y":273.921875},{"x":218,"y":290.921875},{"x":214,"y":300.921875},{"x":210,"y":311.921875},{"x":207,"y":318.921875},{"x":205,"y":323.921875},{"x":201,"y":328.921875},{"x":197,"y":332.921875},{"x":190,"y":337.921875},{"x":177,"y":343.921875},{"x":169,"y":346.921875},{"x":160,"y":346.921875},{"x":153,"y":346.921875},{"x":145,"y":344.921875},{"x":139,"y":333.921875},{"x":132,"y":310.921875},{"x":131,"y":299.921875},{"x":131,"y":291.921875},{"x":132,"y":286.921875},{"x":137,"y":281.921875},{"x":145,"y":276.921875},{"x":159,"y":273.921875},{"x":183,"y":273.921875},{"x":203,"y":276.921875},{"x":220,"y":282.921875},{"x":251,"y":295.921875},{"x":265,"y":301.921875},{"x":284,"y":307.921875},{"x":295,"y":311.921875},{"x":304,"y":312.921875},{"x":321,"y":314.921875},{"x":330,"y":315.921875},{"x":343,"y":315.921875},{"x":351,"y":314.921875},{"x":357,"y":313.921875},{"x":358,"y":312.921875},{"x":360,"y":309.921875},{"x":361,"y":304.921875},{"x":362,"y":303.921875},{"x":362,"y":302.921875},{"x":362,"y":301.921875},{"x":362,"y":300.921875},{"x":359,"y":297.921875},{"x":350,"y":288.921875},{"x":348,"y":286.921875},{"x":347,"y":285.921875},{"x":346,"y":285.921875},{"x":345,"y":285.921875},{"x":344,"y":285.921875},{"x":344,"y":285.921875}],"brushColor":"#b88f69","brushRadius":2}],"width":300,"height":300};
      // drawingRef.current.loadSaveData(JSON.stringify(drawing), true);
      const drawString = JSON.parse(drawingRef.current.getSaveData());
      setDrawing(drawString);
    }
  };

  useEffect(() => {
    resizeWindow();
    window.addEventListener("resize", resizeWindow);
    return () => window.removeEventListener("resize", resizeWindow);
  }, []);

  return (
    <div className="App">
      <div className="room">
        <div className="canvas" ref={canvasRef} >
          <CanvasDraw lazyRadius={0} canvasWidth={size} canvasHeight={size} ref={drawingRef} />
        </div>
        <div className="sidebar"></div>
      </div>
    </div>
  );
}

export default App;
